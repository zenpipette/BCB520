{
  "hash": "979e21ef5dfad6b86a68e7581c78f453",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"BCB 520 Assignment 3\"\nauthor: \"Sharon\"\ndate: \"2025-01-30\"\nformat: html\n---\n\n\n# Infant Fecal Microbiome Correlations\n\nHerein lies BCB 520 assignment 3, which contains an infant fecal microbiome correlation plot.\n\nWhat does that mean?\n\nFirst, a little bit about the data: I have a data table that contains participants (first column, 21 rows of participant IDs), and bacterial genera read counts averaged over 9 timepoints per participant. There were initially over 1000 bacterial genera columns of data, but I have trimmed it down to the top 30.\n\nBefore I go on, we will load libraries and take a peek at the data table.\n\n\n\n\n\n# Libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(tidyverse)\nlibrary(readr)\nlibrary(Hmisc)\nlibrary(corrplot)\n```\n:::\n\n\n# Import and look at the .rds file\n\nLoad the data set.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nIF_top30 <- readRDS(\"C:/Users/sharo/Desktop/BCB 520/Assignments/IF_top30.rds\")\n```\n:::\n\n\nBelow is subset of the data. You can see the participant ID as the first column (A003, A005, etc) and bacterial genera relative abundance (expressed as percentage) in the following columns. Here we see the first 4 columns of bacteria genera, but for the correlation plot below, we use all 30.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nIF_top30[,1:4]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Bacteroides Escherichia.Shigella Veillonella Clostridium.sensu.stricto\nA003  0.23493134         24.673454640   6.6693137               8.296923750\nA005  4.02761085         20.209190530  11.1726579               6.019777140\nA007  0.19334102          4.074305556  24.9752758               0.659688178\nA009  0.02770472         57.396699533   0.1416980              11.107959633\nA011  9.26831811          4.852269800  18.2515791               0.052937900\nA013  0.25171539         14.938690870  25.1883604               2.902620620\nA015 40.65170057         13.094583838   2.0534671               0.152828987\nA017 29.87910938          4.391378011   5.1910630               0.307567033\nA019 44.56634097          7.588655580   5.0236797               0.106448550\nA021 40.75502674          1.106360367   4.9050189               3.952965600\nA025 34.51478583          1.733203256   3.5605401               0.000000000\nA027  1.02156002          6.573109900  28.7444037              24.638294267\nA029 44.22892401         23.098446878   2.1665187               0.090762833\nA031  0.05744295         62.947694350   3.3153721              26.952580000\nA033 38.51864961         12.478839610   6.6155465               7.548103950\nA035 34.68255444          6.776953956   1.5039755              32.013236233\nA037 14.03453994         18.774367287  10.5120452              24.897731312\nA039  0.11653624         47.718616850  17.9059235               2.086916700\nA041 21.72538480          9.548148850   0.5365920              10.075460910\nA043  8.18592391          0.006921912   4.7780929              17.086879375\nA045 64.73004397          8.060339722   0.2979979               0.002079567\n```\n\n\n:::\n:::\n\n\n# Create correlation matrix\n\nI am using a function \"rcorr\" to easily create a correlation matrix for my data using spearman rank correlations. This is very similar to running a mini regression for each pair of columns in my data table above, except the spearman correlation is for non-parametric data like bacterial relative abundance. \n\nWhat rcorr does is take the column Bacteriodes above and run a correlation with itself, with a resulting correlation coefficient =1. Then it takes Bacteriodes and runs a correlation with Escheria.Shigella, and so on until Bacteriodes has been compared to every other columnn. Then it keeps going and compares \"everything to everything\". See the first plot below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nIF_IF_rcorr <- rcorr(as.matrix(IF_top30), type=c(\"spearman\"))\n```\n:::\n\n\n## Correlation plot \n\nBelow is a raw plot. Note the dark diagonal line that corresponds to correlation 1. This represents something compared to itself (like Bacteriodes to Bacteriodes mentioned above).\n\nEach circle represents the direction and magnitude of the correlation as described by the legend on the left. Strong correlations are indicated with a large, dark circle. Blue means positive correlation, red means negative correlation.\n\nBut wait- I have a better one below. I felt that this plot may be useful to understand what rcorr is doing before I trim it down to what is actually interesting (to me).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(IF_IF_rcorr$r, pch.col='black', pch.cex=0.7,\n         method=c(\"circle\"), tl.cex=0.5)\nmtext(\"Infant Fecal Microbiome Correlation- Basic\", line =3)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\nNow in order to improve the usefulness of the graphic, I have done several things:\n\nRemove the upper triangle. You may notice that the upper and lower triangles are mirror images, so this is just redundant data.\n\nRemove the 1-1 correlations (the dark blue diaganol). The fact that something is 1-1 correlated with itself is not useful or interesting.\n\nFlag significant p values, because it would be nice to know which correlations are actually statistically significant. One star represents a \"trend\" (p < 0.05) and two stars indicate a significant correlation (P < 0.01). [Don't people usually say p < 0.05 is significant? Yes, but this is exploratory data, and we just wanted a rough way to correct for false discovery rate. Don't get me started on p value adjustments for correlation matrices. It's a living nightmare.]\n\nI have also clustered the correlations with similar direction and magnitude using \"Angular order of the Eigenvectors\" (AOE). Basically that groups dots with similar colors and sizes together. There are other clustering methods, but I don't understand them well enough to know which is the best.\n\n# Conclusion\n\nThis is exploratory, hypothesis-generating data. There was no treatment or intervention that should be considered. The type of information we can gather is like this: Bacteriodes appears to be negatively correlated with many other genera. Akkermansia appears postively correlated with several other genera. And so on.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(IF_IF_rcorr$r, p.mat=IF_IF_rcorr$P, sig.level=c(0.01,0.05), \n         insig='label_sig', pch.col='black', pch.cex=0.7,\n         method=c(\"circle\"), tl.cex=0.5, order=\"AOE\", type=\"lower\", diag = F)\nmtext(\"Infant Fecal Microbiome Correlation with AOE Cluster (6 mo avg)\", line =3)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}